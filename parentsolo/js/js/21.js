/**
 * @module       jQuery RD Twitter Feed
 * @author       Rafael Shayvolodyan (raffa)
 * @version      1.0.3
 */
(function(){!function(t,e,a){var i;return i=function(){function i(e,a){this.options=t.extend(!0,{},this.Defaults,a),this.$element=t(e),this.initialize()}return i.prototype.Defaults={username:"templatemonster",list:null,hashtag:null,hideReplies:!0,dateFormat:"%b/%d/%Y",apiPath:"bat/twitter_api/tweet.php",loadingText:"Loading...",localTemplate:{message:"This is sample tweet for local testing. Upload your project to the live hosting server for get data from twitter.com",serverMessage:"RD Twitter Feed: Please upload project to the server for enable plugin!",user_name:"TemplateMonster",date:"Fri Nov 06 11:20:43 +0000 2015",tweet:"Check Out NEW #Photographer Portfolio Responsive Photo - goo.gl/ECjPvq",avatar:"http://pbs.twimg.com/profile_images/611164752396419072/hJYLqLJR_normal.jpg",url:"https://twitter.com/templatemonster/status/660069673464160256",screen_name:"@templatemonster",media_url:["https://pbs.twimg.com/media/CS6HxzwUEAALx0y.jpg","http://pbs.twimg.com/media/CShUCIYUcAABb53.jpg"]},dateText:{seconds:"less 1m",minutes:"m",hours:"h",yesterday:"yd"},callback:!1},i.prototype.initialize=function(){var t;if(t=this.$element,this.options.list&&!this.options.username&&console.error("If you want to fetch tweets from a list, you must define the username of the list owner."),this.isLocal())t.prepend("<h6>"+this.options.localTemplate.message+"</h6>");else if(!this.isServer())return void t.prepend("<h6>"+this.options.localTemplate.serverMessage+"</h6>");t.append('<span id="loading_tweet">'+(t.attr("data-twitter-loading")?t.attr("data-twitter-loading"):this.options.loadingText+"</span>")),this.fetch()},i.prototype.linking=function(t,e){var a,i,r,n,s,o,l,d,p,h;if(p=t.replace(/#([a-zA-Z0-9_]+)/g,'<a href="https://twitter.com/search?q=%23$1&amp;src=hash" target="_blank" title="Search for #$1">#$1</a>').replace(/@([a-zA-Z0-9_]+)/g,'<a href="https://twitter.com/$1" target="_blank" title="$1 on Twitter">@$1</a>'),l=t.match(/(https?:\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.]*(\?\S+)?)?)?)/gi),null!==l)for(i=0,n=l.length;n>i;i++){for(o=l[i],a=!1,d=e.entities.urls,r=0,s=d.length;s>r;r++)h=d[r],p=p.replace(o,'<a href="'+h.expanded_url+'" target="_blank">'+h.display_url+"</a> ");a||(p=p.replace(o,""))}return p},i.prototype.dating=function(t,e){var a,i,r,n,s,o,l,d,p,h;if(h=t.split(" "),t=new Date(Date.parse(h[1]+" "+h[2]+", "+h[5]+" "+h[3]+" UTC")),i=new Date,n=(i.getTime()-t.getTime())/1e3,p=["January","February","March","April","May","June","July","August","September","October","November","December"],a={"%d":t.getDate(),"%m":t.getMonth()+1,"%b":p[t.getMonth()].substr(0,3),"%B":p[t.getMonth()],"%y":String(t.getFullYear()).slice(-2),"%Y":t.getFullYear()},r=e?"%Y-%m-%d":this.$element.attr("data-twitter-date-format")?this.$element.attr("data-twitter-date-format"):this.options.dateFormat,60>n)return this.$element.attr("data-twitter-date-seconds")?this.$element.attr("data-twitter-date-seconds"):this.options.dateText.seconds;if(60>n/60)return Math.round(n/60)+(this.$element.attr("data-twitter-date-minutes")?this.$element.attr("data-twitter-date-minutes"):this.options.dateText.minutes);if(24>n/60/60)return Math.round(n/60/60)+(this.$element.attr("data-twitter-date-hours")?this.$element.attr("data-twitter-date-hours"):this.options.dateText.hours);if(2>n/60/60/24)return this.$element.attr("data-twitter-date-yesterday")?this.$element.attr("data-twitter-date-yesterday"):this.options.dateText.yesterday;for(o=r.match(/%[dmbByY]/g),l=0,d=o.length;d>l;l++)s=o[l],r=r.replace(s,a[s]);return r},i.prototype.isLocal=function(){var t,a,i,r;for(r=["127.0.0.1","192.168","localhost"],a=0,i=r.length;i>a;a++)if(t=r[a],e.location.hostname.indexOf(t)>-1)return!0;return!1},i.prototype.isServer=function(){var t;return t=a.location.href,t.indexOf("http://")>-1||t.indexOf("https://")>-1?!0:!1},i.prototype.getMedia=function(t){var e,a,i,r,n;if(!t.extended_entities)return t.entities&&t.entities.media?t.entities.media[0].media_url:null;if(t.extended_entities.media){for(r=[],n=t.extended_entities.media,a=0,i=n.length;i>a;a++)e=n[a],r.push(e.media_url);return r}},i.prototype.getTempData=function(t,e){var a,i,r,n,s,o,l,d,p;if(s=t.$element.find('[data-twitter-type="tweet"]').length,d=Array(),t.isLocal())for(i=r=0,o=s;o>=0?o>r:r>o;i=o>=0?++r:--r)a={user_name:t.options.localTemplate.user_name,date:t.dating(t.options.localTemplate.date,!1),datetime:t.dating(t.options.localTemplate.date,!0),tweet:t.linking(t.options.localTemplate.tweet),avatar:t.options.localTemplate.avatar,url:t.options.localTemplate.url,retweeted:!1,screen_name:t.linking(t.options.localTemplate.screen_name),media_url:t.options.localTemplate.media_url},d.push(a);else for(i=n=0,l=s;l>=0?l>n:n>l;i=l>=0?++n:--n){if(p=!1,e[i])p=e[i];else{if(!e.statuses||!e.statuses[i])break;p=e.statuses[i]}a={user_name:p.user.name,date:t.dating(p.created_at,!1),datetime:t.dating(p.created_at,!0),tweet:t.linking(p.text,p),avatar:p.user.profile_image_url,url:"https://twitter.com/"+p.user.screen_name+"/status/"+p.id_str,retweeted:p.retweeted,screen_name:t.linking("@"+p.user.screen_name,p)},a.media_url=t.getMedia(p),d.push(a)}return d},i.prototype.fetch=function(){var e;e=this.$element,t.getJSON(this.options.apiPath,{username:e.attr("data-twitter-username")?e.attr("data-twitter-username"):this.options.username,list:e.attr("data-twitter-listname")?e.attr("data-twitter-listname"):this.options.list,hashtag:e.attr("data-twitter-hashtag")?e.attr("data-twitter-hashtag"):this.options.hashtag,count:e.find('[data-twitter-type="tweet"]').length+3,exclude_replies:this.options.hideReplies},t.proxy(function(t){e.find("#loading_tweet").fadeOut("fast"),this.construct(this.getTempData(this,t))},this)),"function"==typeof this.options.callback&&this.options.callback()},i.prototype.construct=function(t){var e,a,i,r,n,s;for(a=this,e=a.$element.find('[data-twitter-type="tweet"]'),i=r=0,s=e.length;s>=0?s>r:r>s;i=s>=0?++r:--r)"A"===e.prop("tagName")&&this.tweetLink(e.eq(i),t[i]),n=0,e.eq(i).find("*").each(function(){a.parseAttributes(this,t[i],n),this.hasAttribute("data-media_url")&&n++}),e.css("opacity","1")},i.prototype.tweetLink=function(t,e){t.attr("href",e.url)},i.prototype.parseAttributes=function(e,a,i){var r,n,s,o,l,d,p;r=t(e),o=r.data();for(l in o)if(o.hasOwnProperty(l))for(s=o[l].split(/\s?,\s?/i),d=0,p=s.length;p>d;d++)n=s[d],"text"===n.toLowerCase()?e.innerHTML=a[l]:"media_url"===l?t.isArray(a[l])&&a[l].length>i?e.setAttribute(n,a[l][i]):null!==a[l]&&0===i?e.setAttribute(n,a[l]):r.remove():e.setAttribute(n,a[l])},t.fn.extend({RDTwitter:function(e){var a;return this.each(function(){}),a=t(this),a.data("RDTwitter")?void 0:a.data("RDTwitter",new i(this,e))}}),i}()}(window.jQuery,document,window),"undefined"!=typeof module&&null!==module?module.exports=window.RDTwitter:"function"==typeof define&&define.amd&&define(["jquery"],function(){"use strict";return window.RDTwitter})}).call(this);
